
CC = nvcc
CFLAGS = 
fPIC_flag = -Xcompiler=-fPIC

obj_files = fused_elementwise_1198.obj fused_elementwise_1199.obj gemm_rcr_bias_swish_10.obj gemm_rcr_bias_11.obj fused_elementwise_1200.obj gemm_rcr_bias_13.obj conv2d_bias_15.obj groupnorm_swish_16.obj conv2d_bias_17.obj fused_elementwise_1201.obj conv2d_bias_add_identity_1160.obj groupnorm_22.obj conv2d_bias_23.obj layernorm_25.obj gemm_rcr_permute_27.obj fused_elementwise_1202.obj gemm_rcr_permute_32.obj bmm_rcr_35.obj softmax_36.obj bmm_rrr_permute_41.obj gemm_rcr_bias_44.obj fused_elementwise_1203.obj layernorm_47.obj gemm_rcr_permute_49.obj gemm_rcr_permute_54.obj bmm_rcr_57.obj softmax_58.obj bmm_rrr_permute_63.obj fused_elementwise_1205.obj layernorm_69.obj gemm_rcr_bias_fast_gelu_70.obj gemm_rcr_bias_mul_71.obj size_73.obj gemm_rcr_bias_72.obj fused_elementwise_1206.obj conv2d_bias_add_identity_1161.obj fused_elementwise_1208.obj fused_elementwise_1210.obj fused_elementwise_1212.obj fused_elementwise_1213.obj conv2d_bias_145.obj groupnorm_swish_146.obj conv2d_bias_147.obj gemm_rcr_bias_149.obj fused_elementwise_1215.obj groupnorm_swish_152.obj conv2d_bias_154.obj conv2d_bias_add_identity_1164.obj groupnorm_156.obj conv2d_bias_157.obj layernorm_159.obj gemm_rcr_permute_161.obj fused_elementwise_1216.obj gemm_rcr_permute_166.obj bmm_rcr_169.obj softmax_170.obj bmm_rrr_permute_175.obj gemm_rcr_bias_178.obj fused_elementwise_1217.obj layernorm_181.obj gemm_rcr_permute_183.obj gemm_rcr_permute_188.obj bmm_rcr_191.obj softmax_192.obj bmm_rrr_permute_197.obj fused_elementwise_1219.obj layernorm_203.obj gemm_rcr_bias_fast_gelu_204.obj gemm_rcr_bias_mul_205.obj size_207.obj gemm_rcr_bias_206.obj fused_elementwise_1220.obj conv2d_bias_add_identity_1165.obj conv2d_bias_214.obj fused_elementwise_1222.obj fused_elementwise_1224.obj fused_elementwise_1226.obj fused_elementwise_1227.obj conv2d_bias_279.obj groupnorm_swish_280.obj conv2d_bias_281.obj gemm_rcr_bias_283.obj fused_elementwise_1229.obj groupnorm_swish_286.obj conv2d_bias_288.obj conv2d_bias_add_identity_1168.obj groupnorm_290.obj conv2d_bias_291.obj layernorm_293.obj gemm_rcr_permute_295.obj fused_elementwise_1230.obj gemm_rcr_permute_300.obj bmm_rcr_303.obj softmax_304.obj bmm_rrr_permute_309.obj gemm_rcr_bias_312.obj fused_elementwise_1231.obj layernorm_315.obj gemm_rcr_permute_317.obj gemm_rcr_permute_322.obj bmm_rcr_325.obj softmax_326.obj bmm_rrr_permute_331.obj fused_elementwise_1233.obj layernorm_337.obj gemm_rcr_bias_fast_gelu_338.obj gemm_rcr_bias_mul_339.obj size_341.obj gemm_rcr_bias_340.obj fused_elementwise_1234.obj conv2d_bias_add_identity_1169.obj conv2d_bias_348.obj fused_elementwise_1236.obj fused_elementwise_1238.obj fused_elementwise_1240.obj fused_elementwise_1241.obj conv2d_bias_413.obj groupnorm_swish_414.obj conv2d_bias_415.obj fused_elementwise_1243.obj conv2d_bias_add_identity_1172.obj fused_elementwise_1245.obj fused_elementwise_1247.obj groupnorm_441.obj conv2d_bias_442.obj layernorm_444.obj gemm_rcr_permute_446.obj fused_elementwise_1248.obj gemm_rcr_permute_451.obj bmm_rcr_454.obj softmax_455.obj bmm_rrr_permute_460.obj gemm_rcr_bias_463.obj fused_elementwise_1249.obj layernorm_466.obj gemm_rcr_permute_468.obj fused_elementwise_1251.obj layernorm_488.obj gemm_rcr_bias_fast_gelu_489.obj gemm_rcr_bias_mul_490.obj size_492.obj gemm_rcr_bias_491.obj fused_elementwise_1252.obj conv2d_bias_add_identity_1175.obj fused_elementwise_1254.obj concatenate_507.obj groupnorm_swish_508.obj conv2d_bias_509.obj fused_elementwise_1256.obj conv2d_bias_516.obj fused_elementwise_1258.obj fused_elementwise_1260.obj upsampling2d_540.obj concatenate_542.obj groupnorm_swish_543.obj conv2d_bias_544.obj fused_elementwise_1262.obj conv2d_bias_551.obj fused_elementwise_1264.obj fused_elementwise_1266.obj fused_elementwise_1267.obj fused_elementwise_1269.obj fused_elementwise_1271.obj fused_elementwise_1273.obj fused_elementwise_1274.obj concatenate_678.obj groupnorm_swish_679.obj conv2d_bias_680.obj fused_elementwise_1276.obj conv2d_bias_687.obj fused_elementwise_1278.obj fused_elementwise_1280.obj fused_elementwise_1281.obj upsampling2d_746.obj conv2d_bias_747.obj concatenate_748.obj groupnorm_swish_749.obj conv2d_bias_750.obj fused_elementwise_1283.obj conv2d_bias_757.obj fused_elementwise_1285.obj fused_elementwise_1287.obj fused_elementwise_1288.obj concatenate_816.obj groupnorm_swish_817.obj conv2d_bias_818.obj fused_elementwise_1290.obj conv2d_bias_825.obj fused_elementwise_1292.obj fused_elementwise_1294.obj fused_elementwise_1295.obj concatenate_884.obj groupnorm_swish_885.obj conv2d_bias_886.obj fused_elementwise_1297.obj conv2d_bias_893.obj fused_elementwise_1299.obj fused_elementwise_1301.obj fused_elementwise_1302.obj upsampling2d_952.obj conv2d_bias_953.obj concatenate_954.obj groupnorm_swish_955.obj conv2d_bias_956.obj fused_elementwise_1304.obj conv2d_bias_963.obj fused_elementwise_1306.obj fused_elementwise_1308.obj fused_elementwise_1309.obj concatenate_1022.obj groupnorm_swish_1023.obj conv2d_bias_1024.obj fused_elementwise_1311.obj conv2d_bias_1031.obj fused_elementwise_1313.obj fused_elementwise_1315.obj fused_elementwise_1316.obj fused_elementwise_1318.obj fused_elementwise_1320.obj fused_elementwise_1322.obj fused_elementwise_1323.obj conv2d_bias_1159.obj model_container_base.obj utility.obj model_container.obj model_interface.obj ort_ait_custom_op_library.obj

%.obj : %.cu
	nvcc -DCUTLASS_ENABLE_TENSOR_CORE_MMA=1 -DCUTLASS_USE_TANH_FOR_SIGMOID=1 -w -gencode=arch=compute_80,code=[sm_80,compute_80] -Xcompiler=-fPIC -Xcompiler=-Wconversion -Xcompiler=-fno-strict-aliasing -Xcompiler -fvisibility=hidden -O3 -std=c++17 --expt-relaxed-constexpr --use_fast_math -I/work/AITemplate/3rdparty/cutlass/include -I/work/AITemplate/3rdparty/cutlass/tools/util/include -I/work/AITemplate/3rdparty/cutlass/examples/35_gemm_softmax -I/work/AITemplate/3rdparty/cutlass/../../python/aitemplate/backend/cuda/attention/src/./ -I/work/AITemplate/3rdparty/cutlass/../../python/aitemplate/backend/cuda/attention/src/fmha -I/work/onnxruntime/include/ -I/work/onnxruntime/include//onnxruntime/core/session/ -c -o $@ $<
%.obj : %.bin
	ld -r -b binary -o $@ $<

.PHONY: all
all: test.so

test.so: $(obj_files)
	$(CC) -shared $(fPIC_flag) $(CFLAGS) -o $@ $(obj_files)

clean:
	rm -f $(obj_files) test.so